package github.qe7.detect.module.impl.exploit;

import github.qe7.detect.Detect;
import github.qe7.detect.event.Event;
import github.qe7.detect.event.listeners.EventPacket;
import github.qe7.detect.event.listeners.EventUpdate;
import github.qe7.detect.module.Category;
import github.qe7.detect.module.Module;
import github.qe7.detect.setting.impl.SettingMode;
import github.qe7.detect.util.Timer;
import github.qe7.detect.util.chat.AddChatMessage;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S07PacketRespawn;

import java.util.Queue;
import java.util.concurrent.ConcurrentLinkedQueue;

public class Disabler extends Module {

    public SettingMode mode = new SettingMode("Mode", "Watchdogy", "Watchdogy", "Ghostly");
    public static Timer timer = new Timer();
    public Queue<Packet> C0f = new ConcurrentLinkedQueue<>();

    public Disabler() {
        super("Disabler", 0, Category.EXPLOIT);
        addSettings(mode);
    }

    public void onDisable() {
        mc.timer.timerSpeed = 1f;
        C0f.clear();
    }

    public void onEvent(Event event) {
        setSuffix(mode.getValue().toString());
        if (event instanceof EventUpdate) {

            if(timer.hasReached(250L) && !C0f.isEmpty()) {
                mc.getNetHandler().addToSendQueue(C0f.poll());
                AddChatMessage.addChatMessage("Sending");
            }

        }

        if (event instanceof EventPacket) {
            if(((EventPacket) event).getPacket() instanceof S07PacketRespawn) C0f.clear();

            if(((EventPacket) event).getPacket() instanceof C0BPacketEntityAction) event.setCancelled(true);

            if(((EventPacket) event).getPacket() instanceof C03PacketPlayer) {
                event.setCancelled(true);
                C0f.add(((EventPacket) event).getPacket());
                AddChatMessage.addChatMessage("C03");
            }
        }
    }

}
